<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <link rel="icon" type="image/svg+xml" href="favicon.svg" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Vite App</title>
    <style>
      #container {
        padding: 20px 0 30px;
      }

      canvas#main {
        border: 1px solid red !important;
      }
    </style>
    <script src="./dist-wasm/vrender_wasm.js"></script>
  </head>

  <body>
    <div id="app">
      <div class="sidebar" id="sidebar"></div>
      <div class="content">
        <!-- <div id="header">
        <button class="release-button">Release</button>
      </div> -->
        <!-- <div id="container">
          <canvas id="main" width="1200" height="1200" style="width: 600px; height: 600px"></canvas>
          <canvas id="layout" width="1200" height="1200" style="position: fixed"></canvas>
        </div>
        <div id="footer"></div> -->
      </div>
    </div>
    <script src="./stats.js"></script>
    <script type="module" src="./main.ts"></script>
    <script>
      const stats = new Stats();
      stats.showPanel(0); // 0: fps, 1: ms, 2: mb, 3+: custom
      document.body.appendChild(stats.dom);
      createModule().then(module => {
        console.log(module);
        console.time('total');
        console.time('创建canvas生成上下文');
        const window = module._createBrowserWindow(0, 0, 1200, 1200);
        module._setClearColor(window, 1, 0, 1, 1);
        module._initContext(window);
        console.timeEnd('创建canvas生成上下文');
        module._addLayer(window);
        console.time('draw');
        module._drawWindow(window);
        console.timeEnd('draw');
        console.timeEnd('total');
        function animate() {
          stats.begin();
          // arr.forEach(rect => {
          //   Module._setRectFillColor(rect, Math.random(), Math.random(), Math.random(), 1);
          //   Module._setRectStrokeColor(rect, Math.random(), Math.random(), Math.random(), 1);
          //   // Module._setRectWH(rect, Math.random() * 20, Math.random() * 20);
          // });
          module._drawWindow(window);
          stats.end();
          requestAnimationFrame(animate);
        }
        animate();
      });
    </script>
  </body>
</html>
